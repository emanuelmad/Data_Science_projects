---
title: "Amostragem Aleat√≥ria Simples"
subtitle: "Laborat√≥rio de Sensoriamento Remoto"
author: "Por Prof. Dr. Emanuel Ara√∫jo Silva"
output:
  html_document:
    df_print: paged
---

## Introdu√ß√£o

√â o procedimento fundamental de sele√ß√£o a partir do qual derivam os demais processos de amostragem (P√âLLICO NETO; BRENA, 1997; SANQUETTA et al., 2009). A Amostragem Aleat√≥ria Simples (AAS) baseia-se num processo estritamente aleat√≥rio, onde as unidades amostrais (UAs) s√£o selecionadas com igual probabilidade (1/N), em que N √© o n¬∫ total de unidades de amostras que comp√µem o espa√ßo amostral, ou seja, a popula√ß√£o amostrada (QUEIROZ, 1998).
Estimadores da AAS
As principais estimativas a serem obtidas para a AAS s√£o:
a) M√©dia aritm√©tica (x);
b) Vari√¢ncia (sx2);
c) Desvio Padr√£o (sx);
d) Coeficiente de varia√ß√£o (CV%);
e) Intensidade amostral (n);
f) Vari√¢ncia da m√©dia (sx2);
g) Erro padr√£o da m√©dia (sx);
h) Erro de amostragem: absoluto (Ea) e relativo (Er);
i) Intervalo de confian√ßa para m√©dia (ICx);
j) Total da popula√ß√£o (XÃÇ); e
k) Intervalo de confian√ßa para o total (ICXÃÇ).
```{r}
# Carrega o pacote data.table para usar a fun√ß√£o fread
library(data.table)
# L√™ o arquivo CSV "Tectona.csv" e armazena em um data.frame chamado 'teca'
IF <- fread("AAS.csv")
# Imprime o data.frame 'teca' para visualiza√ß√£o
print(IF)
```
Obtendo as estat√≠sticas b√°sicas para as unidades amostrais:
```{r}
#m√©dia
print(mean(IF$Volume))
#Vari√¢ncia
print(var(IF$Volume))
#Desvio Padr√£o
print(sd(IF$Volume))
#Coeficiente de varia√ß√£o (CV%):
print((sd(IF$Volume) / mean(IF$Volume)) * 100)
```

Intensidade amostral (n): A intensidade de amostragem √© fun√ß√£o: i) da variabilidade da vari√°vel de interesse (volume da floresta); ii) do erro de amostragem m√°ximo admiss√≠vel; e iii) do n√≠vel de confian√ßa fixado (P√âLLICO NETO; BRENA, 1997). Assim, para obter a estimativa de n √© necess√°rio obter as seguintes informa√ß√µes:
a) O valor de E (expect√¢ncia do erro) - m3/parcela: Em invent√°rio florestal √© usual estabelecer um erro m√°ximo admiss√≠vel de 10% para estimativa da m√©dia. Ent√£o, para obter o valor de E basta fazer: ùê∏=(ùêøùê∏ . ùë•)
Uma fun√ß√£o para obter o valor de E:
```{r}
# Define a fun√ß√£o E para calcular o erro de amostragem
E <- function(x){ 
  # Calcula a m√©dia aritm√©tica dos dados 'x'
  media = mean(x) 
  # Calcula o erro de amostragem (E) como 10% da m√©dia e arredonda para 4 d√≠gitos significativos
  E = signif(0.1*media, 4) 
  # Retorna o valor calculado de E
  return(E) 
} 
# Chama a fun√ß√£o E com a coluna 'Volume' do data.frame IF
E(IF$Volume)
```

O n√∫mero de unidades amostrais poss√≠veis na popula√ß√£o (N): Quantas unidades de amostra de tamanho de 600 m¬≤ √© poss√≠vel estabelecer na popula√ß√£o, cuja √°rea total √© de 400.000m¬≤ (40 hectares)? Para obter essa informa√ß√£o basta dividir a √°rea da popula√ß√£o pelo tamanho da parcela. Assim, obt√™m-se que s√£o poss√≠veis 667 parcelas de 600m¬≤ na popula√ß√£o. ùëÅ=ùê¥/ùëé
Uma fun√ß√£o para obter o valor de N:
```{r}
# Define a fun√ß√£o N para calcular o n√∫mero total de parcelas (N)
N <- function(A, a){
  # Calcula N arredondando para o pr√≥ximo inteiro o resultado da divis√£o da √°rea total (A) pela √°rea de uma parcela (a)
  N <- ceiling(A/a) 
  # Retorna o valor calculado de N
  return(N) 
} 
# Chama a fun√ß√£o N com A = 400000 e a = 600
N = N(400000, 600) 
# Imprime o valor de N
N
```

c) Determinar se a popula√ß√£o √© finita ou infinita: Para determinar o n√∫mero de unidades de amostras necess√°rias para atender determinada precis√£o e n√≠vel de probabilidade √© necess√°rio saber, antecipadamente, se a popula√ß√£o √© Finita ou Infinita. Para tanto, inicialmente √© preciso obter a fra√ß√£o de amostragem f e, em seguida, observar a conven√ß√£o (P√âLLICO NETO; BRENA, 1997):
{ùëÜùëí 1‚àíùëì‚â•0,98 Popula√ß√£o InfinitaùëÜùëí 1‚àíùëì<0,98 Popula√ß√£o Finita
A fra√ß√£o de amostragem (f) √© dada pela raz√£o entre o n√∫mero de unidades de amostra (n) e o n√∫mero total de unidades de amostra poss√≠veis na popula√ß√£o (N) (P√âLLICO NETO; BRENA, 1997; SANQUETTA et al., 2014):
ùëì=ùëõ/ùëÅ
Uma fun√ß√£o para obter o Fator de Corre√ß√£o (FC) e constatar a natureza da popula√ß√£o. O c√°lculo intermedi√°rio da fra√ß√£o de amostragem (f) √© realizado e tamb√©m retornado. A fun√ß√£o FC recebe tr√™s par√¢metros: x = vetor da vari√°vel de interesse; A = area da popula√ß√£o; e a = tamanho da unidade de amostra. O valor de A e a devem estar na mesma unidade de medida.
```{r}
# Define a fun√ß√£o FC para calcular o Fator de Corre√ß√£o (FC) e a fra√ß√£o da popula√ß√£o amostrada (f)
FC <- function(x, A, a){ 
  # Calcula o n√∫mero de observa√ß√µes na amostra (n) com base no tamanho de 'x'
  n <- length(x) 
  
  # Calcula o n√∫mero total de parcelas (N) arredondando para o pr√≥ximo inteiro a divis√£o da √°rea total (A) pela √°rea de uma parcela (a)
  N <- ceiling(A/a) 
  
  # Calcula a fra√ß√£o da popula√ß√£o amostrada (f) como n/N
  f <- n/N 
  
  # Calcula o Fator de Corre√ß√£o (FC) como 1 - f
  FC <- 1-f 
  
  # Verifica se FC √© maior ou igual a 0.98
  if(FC >= 0.98){ 
    # Imprime uma mensagem indicando que a popula√ß√£o √© considerada infinita
    cat("A popula√ß√£o √© Infinita. Portanto, despreze o FC na f√≥rmula da n.\n") 
  }else{ 
    # Imprime uma mensagem indicando que a popula√ß√£o √© finita
    cat("A popula√ß√£o √© Finita. Portanto, use o FC para corrigir n.\n") 
  }
  
  # Retorna uma lista contendo os valores de 'f' e 'FC'
  return(list(f=f, FC=FC)) 
} 

# Chama a fun√ß√£o FC com os valores da coluna 'Volume' do data.frame IF, A = 400000 e a = 600
FC <- FC(x=IF$Volume, A=400000, a = 600)
```

Determinados os valores de E e N, e constatada a natureza finita da popula√ß√£o, pode-se obter a intensidade de amostragem ideal em fun√ß√£o da vari√¢ncia:
```{r}
# Define a fun√ß√£o 'n' para calcular o tamanho de amostra necess√°rio (n)
n <- function(x, A, a){
  
  # Calcula o n√∫mero total de parcelas (N) arredondando para o pr√≥ximo inteiro a divis√£o da √°rea total (A) pela √°rea de uma parcela (a)
  N <- ceiling(A/a)
  
  # Calcula o erro toler√°vel (E) como 10% da m√©dia aritm√©tica das observa√ß√µes (x)
  E = 0.1 * mean(x)
  
  # Calcula o valor cr√≠tico 't' da distribui√ß√£o t-Student para um n√≠vel de confian√ßa de 95%
  t = qt(1 - .05 / 2, df = length(x) - 1)
  
  # Calcula o tamanho de amostra necess√°rio (n) usando a f√≥rmula Cochran
  n <- ceiling((N * t^2 * var(x)) / (N * E^2 + t^2 * var(x)))
  
  # Imprime o tamanho de amostra necess√°rio (n)
  cat(paste("Para atender ao erro estabelecido voc√™ deve amostrar", n, "parcelas.\n"))
  
  # Verifica se o tamanho da amostra atual (length(x)) √© suficiente
  if(n <= length(x)){
    # Se for suficiente, imprime uma mensagem indicando que o esfor√ßo amostral √© satisfat√≥rio
    cat("Esfor√ßo amostral satisfat√≥rio. O IF √© definitivo!")
  } else {
    # Caso contr√°rio, imprime uma mensagem indicando quantas parcelas adicionais s√£o necess√°rias
    cat(paste("Retorne a campo e me√ßa mais", abs(length(x) - n), "parcelas."))
  }
}

# Chama a fun√ß√£o 'n' com os valores da coluna 'Volume' do data.frame IF, A = 400000 e a = 600
n(x = IF$Volume, A = 400000, a = 600)
```
```{r}
#c√°lculos estat√≠sticos
#Vari√¢ncia da m√©dia 
var(IF$Volume)/length(IF$Volume)*(FC$FC)
#Erro padr√£o da m√©dia (sx) 
sbarx <- sd(IF$Volume)/sqrt(length(IF$Volume))*(sqrt(FC$FC)) 
sbarx 
#Erro de amostragem:
Ea <- qt(1-.05/2, df=length(IF$Volume)-1)*sbarx 
Ea
#Erro de amostragem relativo (Er)
Er <- Ea/mean(IF$Volume)*100 
Er
#Intervalo de confian√ßa para m√©dia (ICx):
# Limite inferior para m√©dia (LI) 
LIbarx <- mean(IF$Volume)-Ea 
LIbarx
# Limite superior para m√©dia (LS) 
LSbarx <- mean(IF$Volume)+Ea 
LSbarx

#Portanto, o IC para m√©dia √©: ICx=[21,61 m3/parcela‚â§X‚â§26,05 m3/parcela]=95%.
#Total da popula√ß√£o: O volume estimado para o total da popula√ß√£o √© dado por:
hatX <- N*mean(IF$Volume) 
hatX

#Intervalo de confian√ßa para o total
#Limite inferior para total da popula√ß√£o (LI) 
LIhatx <- hatX - N*Ea 
LIhatx 
#Limite superior para total da popula√ß√£o (LS) 
LShatx <- hatX + N*Ea 
LShatx
#Portanto, o IC para o total da popula√ß√£o √©: ICXÃÇ=[14.409,8 m3‚â§X‚â§17.374,4 m3]=95%.
```

Observe que para melhor compreens√£o dos c√°lculos os par√¢metros da AAS foram obtidos passo a passo. Por√©m, √© poss√≠vel obter todas as estimativas criando apenas uma √∫nica fun√ß√£o no ambiente R. A seguir √© apresentada uma fun√ß√£o gen√©rica para obter as estimativas da AAS. A fun√ß√£o AAS recebe tr√™s par√¢metros: x = vetor da vari√°vel de interesse; A = area da popula√ß√£o; e a = tamanho da unidade de amostra. Internamente a fun√ß√£o faz o c√°lculo do Fator de Proporcionalidade (FP) para obter os par√¢metros estimados em hectare (ha):
```{r}
AAS <- function(x, A, a){ 
  FP <- 10000/a 
  x <- x*FP 
  Soma <- sum(x) 
  Media <- mean(x, na.rm = TRUE) 
  Variancia <- var(x) 
  N <- ceiling(A/a) 
  f <- length(x)/N 
  FC <- 1-f 
  E = 0.1*mean(x) 
  t = qt(1-.05/2, df=length(x)-1) 
  
  if(FC >= 0.98)
    { cat("\n-------------------------------------------------------------\n A popula√ß√£o √© Infinita.\n") 
    n <- ceiling((t^2*var(x))/E^2) 
    cat("Para atender ao erro estabelecido voc√™ deve amostrar", n, "parcelas.\n") 
    VarM <- var(x)/length(x) 
    SdM <- sqrt(VarM) 
    Ea <- t*SdM 
    Er <- (Ea/Media)*100 
    ICI <- Media - Ea
    ICS <- Media + Ea 
    TotPop <- N*Media 
    ICIP <- ICI*A 
    ICSP <- ICS*A 
    
    if(n <= length(x)){ 
      cat("Esfor√ßo amostral satisfat√≥rio. O IF √© definitivo!") 
    }else{ 
        cat("Retorne a campo e me√ßa mais", abs(length(x)-n), "parcelas.") } 
  }else{ 
      cat("\n-------------------------------------------------------------\n") 
    cat("A popula√ß√£o √© Finita -", "FC =",round(FC,3),"\n") 
    n <- ceiling((N*t^2*var(x))/(N*E^2 + t^2*var(x))) 
    cat("Para atender ao erro estabelecido voc√™ deve amostrar", n, "parcelas.\n") 
    VarM <- var(x)/length(x)*FC 
    SdM <- (sd(x)/sqrt(length(x)))*sqrt(FC) 
    Ea <- t*SdM 
    Er <- (Ea/Media)*100 
    ICI <- Media - Ea 
    ICS <- Media + Ea 
    TotPop <- N*Media 
    ICIP <- ICI*A 
    ICSP <- ICS*A 
    if(n <= length(x)){ 
      cat("Esfor√ßo amostral satisfat√≥rio. O IF √© definitivo!") 
    }else{ 
        cat("ATEN√á√ÉO: Retorne a campo e me√ßa mais", abs(length(x)-n), "parcelas.") 
      } 
  } 
  cat("\n-------------------------------------------------------------\n") 
  
  df <- format(data.frame(Parametros= c("Soma", "M√©dia", "N√∫mero de amostras poss√≠veis", "Fra√ß√£o de amostragem", "Erro m√°ximo admiss√≠vel", "t-student", "Intensidade amostral", "Vari√¢ncia da m√©dia", "Erro padr√£o da M√©dia", "Erro de amostragem absoluto", "Erro de amostragem relativo", "IC inferior para m√©dia", "IC superior para m√©dia", "Total da popula√ß√£o", "IC inferior para total da popula√ß√£o", "IC superior para total da popula√ß√£o"), 
      Estimativas=c(Soma, Media, N, f, E, t, n, VarM, SdM, Ea, Er, ICI, ICS, TotPop, ICIP, ICSP)), justify = "right", digits = 6, nsmall=3, scientific=FALSE) 
  return(df) }
AAS(x = IF$Volume, A = 400000, a = 600)
```

