---
title: "An√°lise Fitossociol√≥gica"
subtitle: "Laborat√≥rio de Sensoriamento Remoto"
author: "Por Prof. Dr. Emanuel Ara√∫jo Silva"
output:
  html_document:
    df_print: paged
---

Estrutura Horizontal
A an√°lise fitossociol√≥gica da floresta abrange a estimativa de diversos par√¢metros. Os par√¢metros fitossociol√≥gicos da estrutura horizontal podem ser expressos, em valores absolutos e relativos (MUELLER-DOMBOIS; ELLENBERG, 1974). Os principais par√¢metros fitossociol√≥gicos da estrutura horizontal s√£o (MUELLER-DOMBOIS; ELLENBERG, 1974; SANQUETTA et al., 2014; SOUZA; SOARES, 2013):
1. Densidade absoluta (DAi) da i-√©sima esp√©cie, em n√∫mero de indiv√≠duos por hectare, por esp√©cie;
2. Densidade relativa (DRi) da i-√©sima esp√©cie, em porcentagem;
3. Domin√¢ncia absoluta (DoAi) da i-√©sima esp√©cie (m2.ha-1);
4. Domin√¢ncia relativa (DoRi) da i-√©sima esp√©cie, em porcentagem;
5. Frequ√™ncia absoluta (FAi) da i-√©sima esp√©cie, em porcentagem;
6. Frequ√™ncia relativa (FRi) da i-√©sima esp√©cie, em porcentagem;
7. Valor de cobertura (VCi) da i-√©sima esp√©cie, em porcentagem;
8. Porcentagem de cobertura (PCi) da i-√©sima esp√©cie;
9. Valor de import√¢ncia (VIi) da i-√©sima esp√©cie, em porcentagem; e
10. Porcentagem de import√¢ncia (PIi) da i-√©sima esp√©cie.

A seguir os principais par√¢metros fitossociol√≥gicos da estrutura horizontal ser√£o obtidos usando a linguagem R. Os dados foram obtidos de parcelas permanentes instaladas em Floresta Ombr√≥fila Mista (FOM), com n√≠vel de inclus√£o de 10cm (DAP ‚â• 10 cm). Foram estabelecidas 3 parcelas de 1000 m¬≤ (0.1 ha), com √°rea total amostra (A) de 0.3 ha. Para fins did√°ticos, ser√£o apresentados os c√≥digos para obter os par√¢metros da estrutura horizontal da esp√©cie Araucaria angustifolia e, em seguida, mostrar-se-√° um c√≥digo para obter os par√¢metros de todas as esp√©cies de uma s√≥ vez usando o pacote data.table para manipula√ß√£o de dados (DOWLE; SRINIVASAN, 2017):

```{r}
library("data.table") # Pacote para manipula√ß√£o de dados 
FOM <- fread("Fito.csv") # Carrega o conjunto de dados 
print(FOM)
```
Inicialmente, pode-se fazer uma breve inspe√ß√£o dos dados:
```{r}
nrow(FOM)
names(FOM) 
dim(FOM) 
# n = N√∫mero total de indiv√≠duos amostrados na j-√©sima parcela 
FOM[, .(n=.N), by=Parcela][]
```

```{r}
# N√∫mero de indiv√≠duos amostrados da i-√©sima esp√©cie na j-√©sima parcela 
FOM[, .(ni=.N), by=c("Parcela", "Especie")]
```
Plotar Gr√°fico 
```{r}
# Carrega os pacotes necess√°rios
library("ggplot2")

# Calcula o n√∫mero total de indiv√≠duos para cada parcela
FOM_total <- FOM[, .(n = .N), by = Parcela]

# Calcula o n√∫mero de indiv√≠duos para cada esp√©cie em cada parcela
FOM_individual <- FOM[, .(ni = .N), by = c("Parcela", "Especie")]

# Plotando o gr√°fico
ggplot(FOM_individual, 
       aes(x = Especie, y = ni, fill = Especie)) +
  geom_bar(stat = "identity", position = "dodge", width = 1, colour = "black") +
  geom_text(aes(label = ni), hjust = -0.3, vjust = 0.5, position = position_dodge(width = 0.9)) +
  facet_grid(~ Parcela, labeller = as_labeller(c(`1` = "Parcela 1", `2` = "Parcela 2", `3` = "Parcela 3"))) +
  coord_flip() +
  theme_bw() +
  theme(
    axis.line.x = element_line(size = 0.5, colour = "black"),
    axis.line.y = element_line(size = 0.5, colour = "black"),
    strip.text.x = element_text(colour = 1, size = 12, family = "serif", face = "bold"),
    strip.background = element_rect(colour = "black", fill = "snow2"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.border = element_rect(color = "black"),
    panel.background = element_blank(),
    axis.text.x = element_text(colour = "black", size = 12, family = "serif", angle = 0),
    axis.text.y = element_text(colour = 1, size = 12, family = "serif", face = "italic"),
    legend.position = "none"
  ) +
  scale_x_discrete(name = "Esp√©cie") +
  scale_y_continuous(name = "N√∫mero de indiv√≠duos", limits = c(0, 8))
```
Obtendo os par√¢metros fitossociol√≥gicos da estrutura horizontal:
1. Densidade absoluta (DAi): Para obter a DAi √© necess√°rio o conhecimento do n√∫mero de individuos amostrados da i-√©sima esp√©cie (ni) e da √°rea total amostra (A):
- Araucaria angustifolia
```{r}
DAi <- function(x, A){ 
  ni <- nrow(subset(FOM, Especie=="Araucaria angustifolia")) 
  DAi <- ni/A 
  return(DAi) 
  } 
DAi(x = FOM$Especie, A = 0.3)
```
Densidade relativa (DRi): Para obter a densidade relativa de cada esp√©cie basta usar a f√≥rmula abaixo. Em que: s = n√∫mero total de esp√©cies observadas.
- Araucaria angustifolia
```{r}
DRi <- function(x, A){ 
  ni <- nrow(subset(FOM, Especie=="Araucaria angustifolia")) 
  DAi <- ni/A 
  DTA <- length(x)/A 
  DRi <- (DAi/DTA)*100 
  return(DRi) 
  } 
DRi(x = FOM$Especie, A = 0.3)
```
Domin√¢ncia absoluta (DoAi) - m2.ha-1: Para obter a domin√¢ncia absoluta √© necess√°rio o c√°lculo pr√©vio das √°reas transversais (gj) da j-√©sima √°rvore. Em seguida, a √°rea basal da esp√©cie (Gi) √© obtida pela soma das gj para cada esp√©cie. Por fim, a DoAi da i-√©sima esp√©cie √© calculada pela raz√£o da Gi pela √°rea total amostrada (A):
- Araucaria angustifolia
```{r}
DoAi <- function(data, A, ...){ 
  data <- data[Especie=="Araucaria angustifolia"] 
  gi <- data[, .(gi=pi*DAP^2/40000)] 
  Gi <- sum(gi) 
  DoAi <- Gi/A 
  return(DoAi) 
  } 
DoAi(data=FOM, A=0.3)
```
Domin√¢ncia relativa (DoRi): A domin√¢ncia relativa da i-√©sima esp√©cie √© calculada pela raz√£o da domin√¢ncia absoluta de cada esp√©cie (DoAi) pela domin√¢ncia total (soma dos valores de DoAi para cada esp√©cie). Alternativamente, pode-se fazer a raz√£o da √°rea basal da i-√©sima esp√©cie (Gi) pela soma das √°reas basais de todas as esp√©cies amostradas (GT):
- Araucaria angustifolia
```{r}
DoRi <- function(data, A, ...){ 
  Gt <- data[, .(gi=pi*DAP^2/40000)] 
  data <- data[Especie=="Araucaria angustifolia"] 
  gi <- data[, .(gi=pi*DAP^2/40000)] 
  Gi <- sum(gi) 
  DoAi <- Gi/A 
  DoRi <- (Gi/sum(Gt))*100 
  return(DoRi) 
  } 
DoRi(data=FOM, A=0.3)
```
Frequ√™ncia absoluta (FAi): A frequ√™ncia absoluta de cada esp√©cie √© calculada pela raz√£o do n√∫mero de unidades de amostras (Ui) onde foram encontradas a i-√©sima esp√©cie e o n√∫mero total de unidades de amostras (UT). Pode-se multiplicar por 100 para obter o par√¢metro relativizado:
- Araucaria angustifolia
```{r}
FAi <- function(data, ...){ 
  Ut <- length(unique(data$Parcela)) 
  Ui <- unique(data, by=c("Especie", "Parcela"))[, .(Ui=.N), by="Especie"]
  Ui <- Ui[Especie=="Araucaria angustifolia", Ui] 
  FAi <- (Ui/Ut)*100 
  return(FAi) 
  } 
FAi(data=FOM)
```
Frequ√™ncia relativa (FRi): A frequ√™ncia relativa da i-√©sima esp√©cie √© calculada pela raz√£o da frequ√™ncia absoluta de cada esp√©cie (FAi) pela frequ√™ncia total (soma dos valores de FAi para cada esp√©cie):
- Araucaria angustifolia
```{r}
FRi <- function(data, ...){ 
  Ut <- length(unique(FOM$Parcela)) 
  Ui <- unique(FOM, by=c("Especie", "Parcela"))[, .(Ui=.N), by="Especie"] 
  FAi <- Ui[, .(FAi=(Ui/length(unique(FOM$Parcela)))*100)]
  Ui_AA <- Ui[Especie=="Araucaria angustifolia", Ui] 
  FAi_AA <- (Ui_AA/Ut)*100 
  FRi <- (FAi_AA /sum(FAi))*100 
  return(FRi) 
  } 
FRi(data=FOM)
```

Valor de cobertura (VCi): O valor de cobertura integra os par√¢metros de densidade e domin√¢ncia relativa, isto √©, o VCi √© soma de DRi e DoRi de cada esp√©cie:
ùëâùê∂ùëñ=ùê∑ùëÖùëñ+ùê∑ùëúùëÖùëñ
- Araucaria angustifolia
```{r}
VCi <- DRi(x = FOM$Especie, A = 0.3) + DoRi(data=FOM, A=0.3) 
VCi
```

Porcentagem de cobertura (PCi): Por extens√£o, pode-se obter a porcentagem de cobertura da i-√©sima esp√©cie fazendo-se a m√©dia de DRi e DoRi:
ùëÉùê∂ùëñ=(ùê∑ùëÖùëñ+ùê∑ùëúùëÖùëñ)/2
- Araucaria angustifolia
```{r}
PCi <- (DRi(x = FOM$Especie, A = 0.3) + DoRi(data=FOM, A=0.3))/2 
PCi
```

Valor de import√¢ncia (VIi): O valor de import√¢ncia integra os par√¢metros de densidade, domin√¢ncia e frequ√™ncia relativa, isto √©, o VIi √© soma de DRi, DoRi e FRi de cada esp√©cie:
ùëâùêºùëñ=ùê∑ùëÖùëñ+ùê∑ùëúùëÖùëñ+ùêπùëÖùëñ
- Araucaria angustifolia
```{r}
VIi <- DRi(x = FOM$Especie, A = 0.3) + DoRi(data=FOM, A=0.3) + FRi(data=FOM) 
VIi
```

Porcentagem de import√¢ncia (PIi): Por extens√£o, pode-se obter a porcentagem de import√¢ncia da i-√©sima esp√©cie fazendo-se a m√©dia de DRi, DoRi e FRi:
ùëÉùêºùëñ=(ùê∑ùëÖùëñ+ùê∑ùëúùëÖùëñ+ùêπùëÖùëñ)/3
- Araucaria angustifolia
```{r}
PIi <- (DRi(x = FOM$Especie, A = 0.3) + DoRi(data=FOM, A=0.3) + FRi(data=FOM))/3 
PIi
```

Inicialmente, para melhor compreens√£o dos c√°lculos os par√¢metros da estrutura horizontal foram obtidos apenas para a esp√©cie Araucaria angustifolia. Por√©m, √© poss√≠vel obter todas as estimativas criando-se apenas uma √∫nica fun√ß√£o no ambiente R. A seguir √© apresentada uma fun√ß√£o gen√©rica para obter os par√¢metros fitossociol√≥gicos da estrutura horizontal. A fun√ß√£o EH recebe quatro par√¢metros: species = vetor contendo as esp√©cies inventariadas; sample = vetor indicando as parcelas de ocorr√™ncia das esp√©cies; d = vetor com di√¢metro das √°rvores; e A = escalar indicando a √°rea total amostrada:
```{r}
# Uma fun√ß√£o para calcular todas as esp√©cies
EH <- function(species, sample, d, A, ...) {
  DT <- data.table(species = species, sample = sample, d = d)
  DT[, `:=`(gi = pi * d^2 / 40000)]
    Ui <- unique(DT, by = c("species", "sample"))[, .(Ui = .N), by = "species"][order(species)]
  ni <- DT[, .(ni = .N, Gi = sum(gi)), by = "species"]
  ni <- ni[Ui, on = "species"]
  EH <- ni[, DAi := ni / A
          ][, DRi := (DAi / sum(DAi)) * 100
            ][, DoAi := Gi / A
              ][, DoRi := (DoAi / sum(DoAi)) * 100
                ][, VCi := DRi + DoRi
                  ][, PCi := VCi / 2
                    ][, FAi := (Ui / length(unique(DT$sample))) * 100
                      ][, FRi := (FAi / sum(FAi)) * 100
                        ][, VIi := DRi + DoRi + FRi
                          ][, PIi := VIi / 3][order(-VIi)]
  
  return(EH)
}
EH <- EH(species = FOM$Especie, sample = FOM$Parcela, d = FOM$DAP, A = 0.3)
print(EH)
```